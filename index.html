<!DOCTYPE html>
<html lang='zh-CN'>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link href="https://cdn.bootcss.com/mdui/0.4.0/css/mdui.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/mdui/0.4.0/js/mdui.min.js"></script>
<script src="https://cdn.bootcss.com/marked/0.3.18/marked.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.16/vue.js"></script>
<script src="https://cdn.bootcss.com/KaTeX/0.9.0/katex.min.js"></script>
<link href="https://cdn.bootcss.com/KaTeX/0.9.0/katex.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/KaTeX/0.9.0/contrib/auto-render.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/haskell.min.js"></script>
<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/lodash.js/4.17.5/lodash.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.js"></script>
<script src="https://cdn.bootcss.com/vue-router/3.0.1/vue-router.js"></script>
<title>Lunatic World</title>
<header>
    <div class="mdui-appbar mdui-appbar-fixed">
        <div class="mdui-toolbar mdui-color-theme">
            <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#left-drawer'}">
                <i class="mdui-icon material-icons">menu</i>
            </a>
            <span class="mdui-typo-title">Lunatic World</span>
            <div class="mdui-toolbar-spacer"></div>
        </div>
    </div>
</header>

<body class="mdui-theme-primary-indigo mdui-theme-accent-pink mdui-appbar-with-toolbar mdui-drawer-body-left">
    <div id="app">
        <div class="mdui-drawer" id="left-drawer">
            <ul class="mdui-list" v-for="i in articles">
                <router-link :to="root_dir+'/post/'+i.filename+'/'+i.title">
                    <li class="mdui-list-item mdui-ripple">
                        <!-- <i class="mdui-list-item-icon mdui-icon material-icons">laptop_chromebook</i> -->
                        <div class="mdui-list-item-content">{{ i.title }}</div>
                    </li>
                </router-link>
            </ul>
        </div>
        <div class="mdui-container">
            <router-view></router-view>
        </div>
    </div>
    </div>
</body>
<script>
    const Passage = {
        props: ['filename', 'title'],
        template: `
        <div v-if="!loading">
            <div class="mdui-typo-display-3 mdui-m-t-2 mdui-m-b-2">{{ title }}</div>
            <div class="mdui-divider mdui-m-t-1 mdui-m-b-1"></div>
            <div class="mdui-typo" v-html="md"></div>
        </div>
        <div class="mdui-spinner mdui-center mdui-valign mdui-m-t-4" v-else></div>
        `,
        data: function () {
            return {
                loading: true,
                md: "",
            }
        },
        mounted() {
            mdui.mutation()
            this.compiledMarkdown(this.filename)
        },
        methods: {
            compiledMarkdown: function (filename) {
                this.loading = true
                axios.get(filename).then(function (response) {
                        this.loading = false
                        this.md = marked(response.data, {
                            sanitize: true
                        })
                    }.bind(this))
                    .catch(function (error) {
                        console.log(error)
                    })
            },
            renderMath: function () {
                _.delay(
                    function () {
                        renderMathInElement(document.body, {
                            delimiters: [{
                                    left: "$$",
                                    right: "$$",
                                    display: true
                                },
                                {
                                    left: "\\[",
                                    right: "\\]",
                                    display: true
                                },
                                {
                                    left: "\\(",
                                    right: "\\)",
                                    display: false
                                },
                                {
                                    left: "$",
                                    right: "$",
                                    display: false
                                }
                            ]
                        });
                        mdui.JQ('pre code').each(function (i, block) {
                            hljs.highlightBlock(block);
                        });
                    }, 100)
            }
        },
        watch: {
            loading: function () {
                this.renderMath()
            },
            filename: function() {
                this.compiledMarkdown(this.filename)
            }
        }
    }
    const router = new VueRouter({
        routes: [{
            path: '/post/:filename/:title',
            component: Passage,
            props: true
        }]
    })
    var app = new Vue({
        el: '#app',
        router,
        data: {
            author: "",
            root_dir: "",
            articles: [],
        },
        created() {
            fetch('./data.json')
                .then(response => response.json())
                .then(json => {
                    this.articles = json.data
                    this.author = json.author
                    this.root_dir = json.root_dir
                })
        }
    })
</script>